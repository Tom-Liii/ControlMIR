# 250218.md
## Bug
- code 
```python
# models/controlnet_union.py line 915
else:
    sample, res_samples = downsample_block(hidden_states=sample, temb=emb) # BUG
```
- error
```
RuntimeError: The size of tensor a (32) must match the size of tensor b (320) at non-singleton dimension 4
```
## Check
- inconsistent image shape between input and required
```
# ours
-> sample, res_samples = downsample_block(hidden_states=sample, temb=emb) # BUG
(Pdb) sample.shape
torch.Size([2, 320, 32, 32])

# inference
-> sample, res_samples = downsample_block(hidden_states=sample, temb=emb) # BUG
(Pdb) sample.shape
torch.Size([2, 320, 126, 126])
```
- possible bug in latent preparation `promax/controlnet_union_train_medical_image_restoration.py` `line 1389`
```
## when passing to forward() 
```
## Solved; Now can proceed to training
- but encounter CUDA out of memory problem